<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <script type="application/javascript" src="../jquery-3.3.1.min.js"></script>
</head>
<body>
<h2>Kanban game</h2>
<canvas id="canvas" width="1700" height="1000">
    current stock price: $3.15 + 0.15
</canvas>
<script type="application/javascript">


    $(function() {
        setTimeout("draw()", 500);
    });

    let shiftX = 10;
    let shiftY = 10;
    let widthBoard = 1600;
    let heightBoard = 950;
    let x = 0;

    function draw() {
        let canvas = document.getElementById('canvas');
        if (canvas.getContext) {
            let ctx = canvas.getContext('2d');
            ctx.clearRect(shiftX, shiftY, widthBoard, heightBoard);
            let boardSpecs = drawBoard(ctx, widthBoard, heightBoard, shiftX, shiftY);
            $.getJSON("http://localhost:8080/work", function (data) {
                console.log(data);
            });

            //card(ctx, boardSpecs.laneWidth, boardSpecs.laneHeight, boardSpecs.standardLaneLevel, x, 0);
            //card(ctx, boardSpecs.laneWidth, boardSpecs.laneHeight, boardSpecs.expediteLaneLevel, 7 - x, 0);
            x++;
        }
        if (x < 10) {
            setTimeout("draw()", 500);
        }
    }

    function card(ctx, laneWidth, laneHeight, laneLevel, i, j) {
        let padding = 10;
        rr(ctx, laneWidth * i + padding + shiftX, laneLevel + laneHeight * j + padding + shiftY, laneWidth * (i + 1) - padding + shiftX, laneLevel + laneHeight * (j + 1) + shiftY, 5, "#333")
    }

    function drawBoard(ctx, widthBoard, heightBoard) {
        let spec = {
            "laneWidth": widthBoard / 8,
            "laneHeight": heightBoard * 0.1,
            "expediteLaneLevel": heightBoard * 0.2,
            "standardLaneLevel": heightBoard * 0.35,
            "colors": {
                "border": "#cccccc",
                "backlog": "#b800dd",
                "analysis": "#ce1212",
                "development": "#1266cf",
                "testing": "#008100",
                "deployed": "#000000"
            }
        };
        //Lanes
        ctx.lineWidth = 3;
        let radius = 25;
        rr(ctx, shiftX, shiftY, widthBoard + shiftX, heightBoard + shiftY, radius, spec.colors.border);
        rr(ctx, shiftX, spec.expediteLaneLevel + shiftY, widthBoard + shiftX, spec.standardLaneLevel + shiftY, 0, spec.colors.border);


        ln(ctx, shiftX, shiftY + radius, shiftX, heightBoard - radius + shiftY, spec.colors.backlog, [1, 0]);
        ln(ctx, spec.laneWidth + shiftX, shiftY, spec.laneWidth + shiftX, heightBoard + shiftY, spec.colors.border, [1, 0]);
        ln(ctx, spec.laneWidth * 2 + shiftX, heightBoard * 0.15 + shiftY, spec.laneWidth * 2 + shiftX, heightBoard + shiftY, spec.colors.analysis, [1, 0]);
        ln(ctx, spec.laneWidth + shiftX, heightBoard * 0.15 + shiftY, spec.laneWidth * 3 + shiftX, heightBoard * 0.15 + shiftY, spec.colors.analysis, [20, 5]);
        ln(ctx, spec.laneWidth * 3 + shiftX, shiftY, spec.laneWidth * 3 + shiftX, heightBoard + shiftY, spec.colors.border, [1, 0]);
        ln(ctx, spec.laneWidth * 4 + shiftX, heightBoard * 0.15 + shiftY, spec.laneWidth * 4 + shiftX, heightBoard + shiftY, spec.colors.development, [1, 0]);
        ln(ctx, spec.laneWidth * 3 + shiftX, heightBoard * 0.15 + shiftY, spec.laneWidth * 5 + shiftX, heightBoard * 0.15 + shiftY, spec.colors.development, [20, 5]);
        ln(ctx, spec.laneWidth * 5 + shiftX, shiftY, spec.laneWidth * 5 + shiftX, heightBoard + shiftY, spec.colors.border, [1, 0]);
        ln(ctx, spec.laneWidth * 6 + shiftX, shiftY, spec.laneWidth * 6 + shiftX, heightBoard + shiftY, spec.colors.testing, [1, 0]);
        ln(ctx, spec.laneWidth * 7 + shiftX, shiftY, spec.laneWidth * 7 + shiftX, heightBoard + shiftY, spec.colors.deployed, [1, 0]);

        return spec;
    }

    function ln(ctx, x1, y1, x2, y2, color, dashed) {
        ctx.setLineDash(dashed);
        ctx.strokeStyle = color;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }

    function rr(ctx, x1, y1, x2, y2, r, color) {
        ctx.strokeStyle = color;
        ctx.beginPath();
        ctx.moveTo(x1 + r, y1);
        ctx.lineTo(x2 - r, y1);
        ctx.arc(x2 - r, y1 + r, r, 1.5 * Math.PI, 0);
        ctx.lineTo(x2, y2 - r);
        ctx.arc(x2 - r, y2 - r, r, 0, 0.5 * Math.PI);
        ctx.lineTo(x1 + r, y2);
        ctx.arc(x1 + r, y2 - r, r, 0.5 * Math.PI, Math.PI);
        ctx.lineTo(x1, y1 + r);
        ctx.arc(x1 + r, y1 + r, r, Math.PI, 1.5 * Math.PI);
        ctx.stroke();
    }

</script>
</body>
</html>